<div class="space-y-6 p-4">
  <!-- ‚úÖ Notification -->
  <div
    *ngIf="notification.show"
    [ngClass]="[
      'fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg border-l-4 flex items-center gap-3 min-w-80 max-w-md',
      notification.type === 'success'
        ? 'bg-green-50 border-green-500 text-green-700'
        : 'bg-red-50 border-red-500 text-red-700'
    ]"
  >
    <div
      [ngClass]="[
        'p-1 rounded-full',
        notification.type === 'success' ? 'bg-green-100' : 'bg-red-100'
      ]"
    >
      <span *ngIf="notification.type === 'success'">‚úì</span>
      <span *ngIf="notification.type === 'error'">‚ö†</span>
    </div>
    <div class="flex-1">
      <p class="font-medium">
        {{ notification.type === 'success' ? 'Success!' : 'Error!' }}
      </p>
      <p class="text-sm">{{ notification.message }}</p>
    </div>
    <button (click)="closeNotification()">√ó</button>
  </div>

  <!-- ‚úÖ Header -->
  <div class="flex items-center justify-between">
    <h1 class="text-3xl font-bold text-blue-700">Ticketing System</h1>
    <div class="flex gap-50">
      <button
        (click)="showFilters = !showFilters"
        [ngClass]="[
          'px-4 py-2 rounded flex items-center gap-2 border',
          hasActiveFilters ? 'bg-blue-500 text-white' : 'bg-white'
        ]"
      >
        ‚öô Filters
        <span
          *ngIf="hasActiveFilters"
          class="bg-red-500 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center"
        >
          !
        </span>
      </button>
      <button
        class="bg-blue-600 text-white px-4 py-2 rounded"
        (click)="onAddTicket()"
      >
        + Add Ticket
      </button>
      <button
        class="bg-green-600 text-white px-4 py-2 rounded"
        (click)="exportToExcel()"
      >
        ‚¨á Export Excel
      </button>
    </div>
  </div>

  <!-- ‚úÖ Summary Cards -->
  <div class="grid grid-cols-4 md:grid-cols-2 gap-2 mt-2">
    <div class="p-4 bg-blue-100 text-center rounded shadow">
      <h3 class="font-semibold">Total Tickets</h3>
      <p class="text-2xl font-bold">{{ filteredTickets.length }}</p>
    </div>
    <div class="p-4 bg-green-100 text-center rounded shadow">
      <h3 class="font-semibold">Closed</h3>
      <p class="text-2xl font-bold">{{ getClosedCount() }}</p>
    </div>
    <div class="p-4 bg-red-100 text-center rounded shadow">
      <h3 class="font-semibold">Open</h3>
      <p class="text-2xl font-bold">{{ getOpenCount() }}</p>
    </div>
    <div class="p-4 bg-yellow-100 text-center rounded shadow">
      <h3 class="font-semibold">On Hold</h3>
      <p class="text-2xl font-bold">{{ getHoldCount() }}</p>
    </div>
  </div>

  <!-- ‚úÖ Filters -->
  <div *ngIf="showFilters" class="p-4 border rounded-lg bg-white shadow">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-bold">Filters</h3>
      <button (click)="clearFilters()" *ngIf="hasActiveFilters" class="text-sm text-red-600">
        ‚úñ Clear
      </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="font-medium">Status</label>
        <select
          [(ngModel)]="filters.status"
          (change)="handleFilterChange('status', $any($event.target).value)"
          class="w-full border p-2 rounded"
        >
          <option value="">All</option>
          <option *ngFor="let s of statusOptions" [value]="s">{{ s }}</option>
        </select>
      </div>

      <div>
        <label class="font-medium">Client</label>
        <select
          [(ngModel)]="filters.clientName"
          (change)="handleFilterChange('clientName', $any($event.target).value)"
          class="w-full border p-2 rounded"
        >
          <option value="">All</option>
          <option *ngFor="let c of clientOptions" [value]="c">{{ c }}</option>
        </select>
      </div>

      <div>
        <label class="font-medium">Priority</label>
        <select
          [(ngModel)]="filters.priority"
          (change)="handleFilterChange('priority', $any($event.target).value)"
          class="w-full border p-2 rounded"
        >
          <option value="">All</option>
          <option *ngFor="let p of priorityOptions" [value]="p">{{ p }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Ticket Form -->
  <div
    *ngIf="showForm"
    class="p-4 border-2 border-blue-500 bg-white rounded-lg shadow-md"
  >
    <h2 class="text-lg font-bold text-blue-600 mb-4">
      {{ editingIndex !== null ? 'Edit Ticket' : 'Add Ticket' }}
    </h2>

    <form (ngSubmit)="onSubmit()" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label>Client Name</label>
        <select
          [(ngModel)]="form.clientName"
          name="clientName"
          (change)="onFieldChange('clientName', $any($event.target).value)"
          class="w-full border p-2 rounded"
        >
          <option value="">Select Client</option>
          <option *ngFor="let c of clients" [value]="c.clientName">
            {{ c.clientName }}
          </option>
        </select>
      </div>

      <div>
        <label>Location</label>
        <select
          [(ngModel)]="form.location"
          name="location"
          (change)="onFieldChange('location', $any($event.target).value)"
          class="w-full border p-2 rounded"
        >
          <option value="">Select Location</option>
          <option *ngFor="let l of locations" [value]="l.locationName">
            {{ l.locationName }}
          </option>
        </select>
      </div>

      <div>
        <label>Category</label>
        <input
          type="text"
          [(ngModel)]="form.category"
          name="category"
          class="w-full border p-2 rounded"
        />
      </div>

      <div>
        <label>Priority</label>
        <select
          [(ngModel)]="form.priority"
          name="priority"
          class="w-full border p-2 rounded"
        >
          <option>Low</option>
          <option>Medium</option>
          <option>High</option>
        </select>
      </div>

      <div>
        <label>Raised By</label>
        <input
          type="text"
          [(ngModel)]="form.raisedBy"
          name="raisedBy"
          class="w-full border p-2 rounded"
        />
      </div>

      <div>
        <label>Assigned To</label>
        <input
          type="text"
          [(ngModel)]="form.assignedTo"
          name="assignedTo"
          class="w-full border p-2 rounded"
        />
      </div>

      <div class="md:col-span-2">
        <label>Description</label>
        <textarea
          [(ngModel)]="form.description"
          name="description"
          class="w-full border p-2 rounded"
          rows="3"
        ></textarea>
      </div>

      <div>
        <label>Status</label>
        <select
          [(ngModel)]="form.status"
          name="status"
          (change)="onFieldChange('status', $any($event.target).value)"
          class="w-full border p-2 rounded"
        >
          <option>Open</option>
          <option>Hold</option>
          <option>Closed</option>
        </select>
      </div>

      <div>
        <label>Resolution</label>
        <textarea
          [(ngModel)]="form.resolution"
          name="resolution"
          class="w-full border p-2 rounded"
          rows="2"
        ></textarea>
      </div>

      <div class="md:col-span-2 flex justify-end gap-2 mt-4">
        <button
          type="button"
          class="border px-4 py-2 rounded"
          (click)="onCancel()"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="bg-blue-600 text-white px-4 py-2 rounded"
        >
          {{ editingIndex !== null ? 'Update' : 'Create' }}
        </button>
      </div>
    </form>
  </div>

  <!-- ‚úÖ Tickets Table -->
  <div class="border rounded-lg bg-white shadow mt-4">
    <div class="flex justify-between items-center p-3 border-b">
      <h3 class="text-lg font-bold">
        Tickets List
        <span *ngIf="hasActiveFilters" class="text-sm text-gray-600 ml-2">
          (Filtered: {{ filteredTickets.length }} tickets)
        </span>
      </h3>

      <div class="text-sm text-gray-600">
        Showing {{ startIndex + 1 }}‚Äì{{ Math.min(endIndex, filteredTickets.length) }}
        of {{ filteredTickets.length }}
      </div>
    </div>

    <div class="overflow-auto max-h-[500px]">
      <table class="w-full border-collapse text-sm">
        <thead class="bg-blue-600 text-white sticky top-0">
          <tr>
            <th *ngFor="let col of tableColumns" class="p-2 text-left border">
              {{ col }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let ticket of currentTickets; let i = index"
            class="border-b hover:bg-gray-50"
          >
            <td class="p-2 border">{{ ticket.ticketNumber }}</td>
            <td class="p-2 border">{{ ticket.clientName }}</td>
            <td class="p-2 border">{{ ticket.location }}</td>
            <td class="p-2 border">{{ ticket.dateRaised }}</td>
            <td class="p-2 border">{{ ticket.timeRaised }}</td>
            <td class="p-2 border">{{ ticket.category }}</td>
            <td class="p-2 border">{{ ticket.raisedBy }}</td>
            <td class="p-2 border">{{ ticket.assignedTo }}</td>
            <td class="p-2 border">
              <span
                [ngClass]="[
                  'px-2 py-1 rounded text-white text-xs',
                  getStatusColor(ticket.status)
                ]"
              >
                {{ ticket.status }}
              </span>
            </td>
            <td class="p-2 border">{{ ticket.priority }}</td>
            <td class="p-2 border">{{ ticket.resolution }}</td>
            <td class="p-2 border">
              <div class="flex gap-2">
                <button
                  class="border px-2 py-1 rounded text-sm"
                  (click)="onEdit(i)"
                >
                  ‚úèÔ∏è
                </button>
                <button
                  class="bg-red-500 text-white px-2 py-1 rounded text-sm"
                  (click)="onDelete(i)"
                >
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ‚úÖ Pagination -->
    <div *ngIf="totalPages > 1" class="flex justify-between items-center p-3 border-t">
      <span>Page {{ currentPage }} of {{ totalPages }}</span>
      <div class="flex gap-1">
        <button
          class="border px-2 py-1 rounded"
          (click)="goToPage(currentPage - 1)"
          [disabled]="currentPage === 1"
        >
          ‚Üê
        </button>
        <button
          *ngFor="let page of renderPaginationButtons()"
          [ngClass]="[
            'border px-3 py-1 rounded',
            currentPage === page ? 'bg-blue-600 text-white' : ''
          ]"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>
        <button
          class="border px-2 py-1 rounded"
          (click)="goToPage(currentPage + 1)"
          [disabled]="currentPage === totalPages"
        >
          ‚Üí
        </button>
      </div>
    </div>
  </div>
</div>
